generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  schemas  = ["aura"]
}

model UserProfile {
  id                           Int              @id @default(autoincrement())
  name                         String
  phoneNumber                  String           @unique
  weight                       Float?
  height                       Float?
  activityLevel                String?
  workType                     String?
  goals                        String[]
  dietaryRestrictions          String[]
  preferences                  String[]
  allergies                    String[]
  medicalConditions            String[]
  medications                  String[]
  usualMealsPerDay             Int?
  wakeTime                     String?
  sleepTime                    String?
  timezone                     String?
  caloricTarget                Int?
  proteinTarget                Int?
  carbTarget                   Int?
  fatTarget                    Int?
  assistantThreadId            String?
  lastCheckInAt                DateTime?
  lastWeighInAt                DateTime?
  notes                        String?
  createdAt                    DateTime         @default(now())
  updatedAt                    DateTime         @updatedAt
  cpf                          String?          @unique
  isPaymentActive              Boolean          @default(false)
  lastPaymentAt                DateTime?
  nextBillingAt                DateTime?
  subscriptionExpiresAt        DateTime?
  subscriptionPlan             SubscriptionPlan @default(FREE)
  planStyle                    PlanStyle?
  requestsLastReset            DateTime?
  requestsToday                Int              @default(0)
  passwordHash                 String?
  email                        String?
  role                         Role             @default(USER)
  waterReminderEnabled         Boolean          @default(true)
  waterReminderIntervalMinutes Int              @default(180)
  waterReminderLastSent        DateTime?
  meals                        Meal[]
  payments                     Payment[]
  promptUsages                 PromptUsage[]
  userMetricLogs               UserMetricLog[]

  @@map("user_profile")
  @@schema("aura")
}

model Meal {
  id          Int         @id @default(autoincrement())
  userId      Int
  content     String
  mealType    MealType
  timestamp   DateTime    @default(now())
  userProfile UserProfile @relation(fields: [userId], references: [id])

  @@map("meal")
  @@schema("aura")
}

model UserMetricLog {
  id       Int         @id @default(autoincrement())
  userId   Int
  loggedAt DateTime    @default(now())
  weight   Float?
  bodyFat  Float?
  waist    Float?
  hip      Float?
  user     UserProfile @relation(fields: [userId], references: [id])

  @@map("user_metric_log")
  @@schema("aura")
}

model Payment {
  id                    Int              @id @default(autoincrement())
  userId                Int
  asaasPaymentId        String?          @unique
  amount                Float
  plan                  SubscriptionPlan
  status                String
  method                String?
  invoiceUrl            String?
  bankSlipUrl           String?
  transactionReceiptUrl String?
  pixQrCode             String?
  pixPayload            String?
  dueDate               DateTime?
  createdAt             DateTime         @default(now())
  paidAt                DateTime?
  user                  UserProfile      @relation(fields: [userId], references: [id])

  @@map("payment")
  @@schema("aura")
}

model PromptUsage {
  id        Int         @id @default(autoincrement())
  userId    Int
  date      DateTime
  count     Int         @default(0)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  user      UserProfile @relation(fields: [userId], references: [id])

  @@unique([userId, date], name: "userId_date")
  @@map("prompt_usage")
  @@schema("aura")
}

enum MealType {
  BREAKFAST
  LUNCH
  DINNER
  SNACK

  @@schema("aura")
}

enum PlanStyle {
  BALANCEADO
  LOW_CARB
  HIGH_PROTEIN
  VEGANO
  VEGETARIANO
  MEDITERRANEO

  @@schema("aura")
}

enum SubscriptionPlan {
  FREE
  PLUS
  PRO

  @@schema("aura")
}

enum Role {
  USER
  ADMIN

  @@schema("aura")
}
