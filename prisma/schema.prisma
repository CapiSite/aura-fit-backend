generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  schemas  = ["aura"]
}

model UserProfile {
  chatId                String           @id
  name                  String
  cpf                   String           @unique
  email                 String
  weight                Float?
  height                Float?
  activityLevel         String?
  workType              String?
  goals                 String[]
  dietaryRestrictions   String[]
  preferences           String[]
  allergies             String[]
  medicalConditions     String[]
  medications           String[]
  usualMealsPerDay      Int?
  wakeTime              String?
  sleepTime             String?
  timezone              String?
  caloricTarget         Int?
  proteinTarget         Int?
  carbTarget            Int?
  fatTarget             Int?
  planStyle             PlanStyle?
  assistantThreadId     String?
  passwordHash          String?
  lastCheckInAt         DateTime?
  lastWeighInAt         DateTime?
  notes                 String?
  subscriptionPlan      SubscriptionPlan @default(FREE)
  subscriptionExpiresAt DateTime?
  isPaymentActive       Boolean          @default(false)
  lastPaymentAt         DateTime?
  nextBillingAt         DateTime?
  requestsToday         Int              @default(0)
  requestsLastReset     DateTime?
  createdAt             DateTime         @default(now())
  updatedAt             DateTime         @updatedAt
  role                  Role             @default(USER)
  meals                 Meal[]
  payments              Payment[]
  userMetricLogs        UserMetricLog[]

  @@map("user_profile")
  @@schema("aura")
}

model Meal {
  id            Int         @id @default(autoincrement())
  userProfileId String
  content       String
  mealType      MealType
  timestamp     DateTime    @default(now())
  userProfile   UserProfile @relation(fields: [userProfileId], references: [chatId])

  @@map("meal")
  @@schema("aura")
}

model UserMetricLog {
  id       Int         @id @default(autoincrement())
  chatId   String
  loggedAt DateTime    @default(now())
  weight   Float?
  bodyFat  Float?
  waist    Float?
  hip      Float?
  user     UserProfile @relation(fields: [chatId], references: [chatId])

  @@map("user_metric_log")
  @@schema("aura")
}

model Payment {
  id     Int              @id @default(autoincrement())
  chatId String
  amount Float
  plan   SubscriptionPlan
  status String
  method String?
  paidAt DateTime         @default(now())
  user   UserProfile      @relation(fields: [chatId], references: [chatId])

  @@map("payment")
  @@schema("aura")
}

enum MealType {
  BREAKFAST
  LUNCH
  DINNER
  SNACK

  @@schema("aura")
}

enum PlanStyle {
  BALANCEADO
  LOW_CARB
  HIGH_PROTEIN
  VEGANO
  VEGETARIANO
  MEDITERRANEO

  @@schema("aura")
}

enum SubscriptionPlan {
  FREE
  PLUS
  PRO

  @@schema("aura")
}

enum Role {
  USER
  ADMIN

  @@schema("aura")
}
